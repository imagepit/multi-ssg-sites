---
title: "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ | åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆã®æ›¸ãæ–¹"
slug: commenting
status: publish
post_type: page
seo_keywords: "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ, ã‚³ãƒ¡ãƒ³ãƒˆ, ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³, ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°, å¯èª­æ€§, ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§"
seo_description: "ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãŠã‘ã‚‹åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã®æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã€é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆãªã©ã€ã•ã¾ã–ã¾ãªã‚³ãƒ¡ãƒ³ãƒˆã®ç¨®é¡ã¨æ›¸ãæ–¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚"
tags: ["ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ", "ã‚³ãƒ¡ãƒ³ãƒˆ", "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³", "ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°", "å¯èª­æ€§", "ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§"]
image: "https://example.com/images/shell-script-commenting.jpg"
parent: "best-practices"
---

## ğŸ’¬ ã¯ã˜ã‚ã«

ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ãŠã‘ã‚‹é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã¨ä¿å®ˆæ€§ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã¾ã™ã€‚è‰¯ã„ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã‚³ãƒ¼ãƒ‰ã®æ„å›³ã‚’æ˜ç¢ºã«ã—ã€å°†æ¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®¹æ˜“ã«ã—ã€ãƒãƒ¼ãƒ ã§ã®å”æ¥­ã‚’ã‚¹ãƒ ãƒ¼ã‚ºã«ã—ã¾ã™ã€‚ã—ã‹ã—ã€ä¸è¦ãªã‚³ãƒ¡ãƒ³ãƒˆã‚„èª¤ã£ãŸã‚³ãƒ¡ãƒ³ãƒˆã¯ã‹ãˆã£ã¦ã‚³ãƒ¼ãƒ‰ã®ç†è§£ã‚’å¦¨ã’ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã®åŸå‰‡ã¨å®Ÿè·µçš„ãªãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã«ã¤ã„ã¦è©³ã—ãè§£èª¬ã—ã¾ã™ã€‚

### ã“ã®ãƒšãƒ¼ã‚¸ã§å­¦ã¹ã‚‹ã“ã¨

:::note

ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ä»¥ä¸‹ã®ã“ã¨ã‚’å­¦ã³ã¾ã™ï¼š

- ã‚³ãƒ¡ãƒ³ãƒˆã®ç›®çš„ã¨é‡è¦æ€§
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã®æ›¸ãæ–¹
- é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã®æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®åŠ¹æœçš„ãªæ›¸ãæ–¹
- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®æ´»ç”¨æ–¹æ³•
- é¿ã‘ã‚‹ã¹ãã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³
- ã‚³ãƒ¡ãƒ³ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®çµ±åˆ

:::

## ğŸ¯ ã‚³ãƒ¡ãƒ³ãƒˆã®ç›®çš„ã¨é‡è¦æ€§

### ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸»ãªç›®çš„

```bash
# âœ… è‰¯ã„ã‚³ãƒ¡ãƒ³ãƒˆã®ç›®çš„
- ã‚³ãƒ¼ãƒ‰ã®æ„å›³ã‚’èª¬æ˜ã™ã‚‹ï¼ˆä½•ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã ã‘ã§ãªãã€ãªãœãã†ã—ã¦ã„ã‚‹ã®ã‹ï¼‰
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®èƒŒæ™¯ã‚’èª¬æ˜ã™ã‚‹
- åˆ¶ç´„ã‚„å‰ææ¡ä»¶ã‚’æ˜è¨˜ã™ã‚‹
- TODOã‚„FIXMEãªã©ã®æœªæ¥ã®ä½œæ¥­ã‚’è¨˜éŒ²ã™ã‚‹
- APIã®ä½¿ç”¨æ–¹æ³•ã‚’èª¬æ˜ã™ã‚‹

# âŒ æ‚ªã„ã‚³ãƒ¡ãƒ³ãƒˆã®ç›®çš„
- æ˜ç™½ãªã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã™ã‚‹ï¼ˆå†—é•·ï¼‰
- ã‚³ãƒ¼ãƒ‰ã®æ›´æ–°ã¨ã¨ã‚‚ã«æ›´æ–°ã•ã‚Œãªã„ï¼ˆå¤ã„æƒ…å ±ï¼‰
- å€‹äººçš„ãªæ„è¦‹ã‚„æ„Ÿæƒ…ã‚’è¨˜è¿°ã™ã‚‹ï¼ˆéå°‚é–€çš„ï¼‰
```

### ã‚³ãƒ¡ãƒ³ãƒˆã®é‡è¦æ€§

:::note ã‚³ãƒ¡ãƒ³ãƒˆã®é‡è¦æ€§

ã‚³ãƒ¡ãƒ³ãƒˆã¯å˜ãªã‚‹èª¬æ˜æ–‡ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã¯ï¼š

- **ä¿å®ˆæ€§ã®å‘ä¸Š**: å°†æ¥ã®é–‹ç™ºè€…ãŒã‚³ãƒ¼ãƒ‰ã‚’ç†è§£ã—ã‚„ã™ããªã‚‹
- **ãƒã‚°ã®å‰Šæ¸›**: è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®æ„å›³ãŒæ˜ç¢ºã«ãªã‚‹
- **çŸ¥è­˜ã®å…±æœ‰**: ãƒãƒ¼ãƒ å†…ã§ã®æŠ€è¡“çš„ãªçŸ¥è­˜ã‚’ä¼é”
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚½ãƒ¼ã‚¹
- **ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã®ç†è§£ã‚’æ·±ã‚ã‚‹

:::

## ğŸ“„ ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ

### æ¨™æº–çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼

```bash
#!/bin/bash
# =====================================================================
# ãƒ•ã‚¡ã‚¤ãƒ«å: database_backup.sh
# ä½œæˆè€…: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†ãƒãƒ¼ãƒ 
# ä½œæˆæ—¥: 2024-01-15
# æœ€çµ‚æ›´æ–°: 2024-01-20
# æ¦‚è¦: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢ã‚’è¡Œã†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
#
# æ©Ÿèƒ½:
#   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
#   - å¢—åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ã‚µãƒãƒ¼ãƒˆ
#   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã®åœ§ç¸®ã¨æš—å·åŒ–
#   - å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®è‡ªå‹•å‰Šé™¤
#   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çµæœã®ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
#
# ä½¿ç”¨æ–¹æ³•:
#   ./database_backup.sh [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]
#
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³:
#   -f, --full        ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ
#   -i, --incremental  å¢—åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ
#   -r, --restore     ãƒªã‚¹ãƒˆã‚¢ãƒ¢ãƒ¼ãƒ‰
#   -c, --config FILE è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®š
#   -v, --verbose     è©³ç´°ãªå‡ºåŠ›ã‚’æœ‰åŠ¹åŒ–
#   -h, --help        ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
#
# å¼•æ•°:
#   [database_name]   å¯¾è±¡ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åï¼ˆçœç•¥æ™‚ã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
#
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:
#   /etc/db_backup/config.ini ã«è¨­å®šã‚’è¨˜è¿°
#
# çµ‚äº†ã‚³ãƒ¼ãƒ‰:
#   0: æ­£å¸¸çµ‚äº†
#   1: è¨­å®šã‚¨ãƒ©ãƒ¼
#   2: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
#   3: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆã‚¨ãƒ©ãƒ¼
#   4: ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ä¸è¶³
#   5: æ¨©é™ã‚¨ãƒ©ãƒ¼
#
# ä¾å­˜é–¢ä¿‚:
#   - mysqldump 8.0+
#   - gzip 1.6+
#   - gpg 2.0+
#   - mailutils
#
# æ³¨æ„äº‹é …:
#   - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®æ›¸ãè¾¼ã¿æ“ä½œã‚’åœæ­¢ã—ã¦ãã ã•ã„
#   - ååˆ†ãªãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚’ç¢ºä¿ã—ã¦ãã ã•ã„
#   - æš—å·åŒ–éµã®ç®¡ç†ã«ã¯ååˆ†æ³¨æ„ã—ã¦ãã ã•ã„
#
# å¤‰æ›´å±¥æ­´:
#   2024-01-20: å¢—åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ã‚’è¿½åŠ 
#   2024-01-18: æš—å·åŒ–æ©Ÿèƒ½ã‚’å¼·åŒ–
#   2024-01-15: åˆç‰ˆä½œæˆ
#
# ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: MIT License
# =====================================================================

set -euo pipefail

# å®šæ•°ã®å®šç¾©
readonly SCRIPT_VERSION="2.1.0"
readonly CONFIG_FILE="/etc/db_backup/config.ini"
readonly BACKUP_DIR="/var/backups/database"
readonly LOG_FILE="/var/log/db_backup.log"
```

### ç°¡ç•¥åŒ–ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼

```bash
#!/bin/bash
# =====================================================================
# ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# ä½œæˆè€…: é–‹ç™ºãƒãƒ¼ãƒ 
# æ¦‚è¦: CSVãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ã¨é›†è¨ˆã‚’è¡Œã†
# ä½¿ç”¨æ–¹æ³•: ./process_data.sh input.csv output.csv
# =====================================================================

set -euo pipefail
```

## ğŸ”§ é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆ

### é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã®æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```bash
# =====================================================================
# é–¢æ•°å: validate_user_input
# æ¦‚è¦: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®å…¥åŠ›å€¤ã‚’æ¤œè¨¼ã™ã‚‹
#
# å¼•æ•°:
#   $1 (string): æ¤œè¨¼å¯¾è±¡ã®å…¥åŠ›æ–‡å­—åˆ—
#   $2 (string): æ¤œè¨¼ã‚¿ã‚¤ãƒ— (email|phone|zip|username)
#   $3 (int, optional): æœ€å°æ–‡å­—é•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1ï¼‰
#   $4 (int, optional): æœ€å¤§æ–‡å­—é•·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 255ï¼‰
#
# æˆ»ã‚Šå€¤:
#   0: æ¤œè¨¼æˆåŠŸï¼ˆå…¥åŠ›å€¤ã¯æœ‰åŠ¹ï¼‰
#   1: æ¤œè¨¼å¤±æ•—ï¼ˆå…¥åŠ›å€¤ãŒç„¡åŠ¹ï¼‰
#
# å‰¯ä½œç”¨:
#   - æ¤œè¨¼å¤±æ•—æ™‚ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¨™æº–ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã«å‡ºåŠ›
#   - ç’°å¢ƒå¤‰æ•° VALIDATION_ERROR_CODE ã«ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®š
#
# ä¾å­˜é–¢ä¿‚:
#   - regex ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒãƒ³ã‚°æ©Ÿèƒ½
#
# åˆ¶ç´„:
#   - å…¥åŠ›æ–‡å­—åˆ—ã¯1000æ–‡å­—ä»¥å†…ã§ã‚ã‚‹ã“ã¨
#   - ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹æ¤œè¨¼ã‚¿ã‚¤ãƒ—ã®ã¿æŒ‡å®šå¯èƒ½
#
# ä½¿ç”¨ä¾‹:
#   validate_user_input "user@example.com" "email"
#   validate_user_input "03-1234-5678" "phone" 10 15
#
# æ³¨æ„äº‹é …:
#   - ç©ºç™½æ–‡å­—ã¯è‡ªå‹•çš„ã«ãƒˆãƒªãƒ ã•ã‚Œã‚‹
#   - å›½éš›é›»è©±ç•ªå·ã«ã¯å¯¾å¿œã—ã¦ã„ãªã„
# =====================================================================
validate_user_input() {
    local input="$1"
    local validation_type="$2"
    local min_length="${3:-1}"
    local max_length="${4:-255}"

    # å…¥åŠ›å€¤ã®å‰å¾Œã®ç©ºç™½ã‚’ãƒˆãƒªãƒ 
    input=$(echo "$input" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

    # æ–‡å­—é•·ã®æ¤œè¨¼
    if [ ${#input} -lt $min_length ] || [ ${#input} -gt $max_length ]; then
        echo "ã‚¨ãƒ©ãƒ¼: å…¥åŠ›æ–‡å­—åˆ—ã¯${min_length}ã€œ${max_length}æ–‡å­—ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™" >&2
        export VALIDATION_ERROR_CODE=1001
        return 1
    fi

    # æ¤œè¨¼ã‚¿ã‚¤ãƒ—ã”ã¨ã®å‡¦ç†
    case "$validation_type" in
        "email")
            if [[ ! "$input" =~ ^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$ ]]; then
                echo "ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ã§ã™" >&2
                export VALIDATION_ERROR_CODE=1002
                return 1
            fi
            ;;
        "phone")
            if [[ ! "$input" =~ ^[0-9]{2,4}-[0-9]{2,4}-[0-9]{3,4}$ ]]; then
                echo "ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªé›»è©±ç•ªå·å½¢å¼ã§ã™ï¼ˆä¾‹: 03-1234-5678ï¼‰" >&2
                export VALIDATION_ERROR_CODE=1003
                return 1
            fi
            ;;
        "zip")
            if [[ ! "$input" =~ ^[0-9]{3}-[0-9]{4}$ ]]; then
                echo "ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªéƒµä¾¿ç•ªå·å½¢å¼ã§ã™ï¼ˆä¾‹: 123-4567ï¼‰" >&2
                export VALIDATION_ERROR_CODE=1004
                return 1
            fi
            ;;
        "username")
            if [[ ! "$input" =~ ^[a-zA-Z][a-zA-Z0-9_]{2,31}$ ]]; then
                echo "ã‚¨ãƒ©ãƒ¼: ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¯è‹±å­—é–‹å§‹ã®3ã€œ32æ–‡å­—ã®è‹±æ•°å­—ã¨ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™" >&2
                export VALIDATION_ERROR_CODE=1005
                return 1
            fi
            ;;
        *)
            echo "ã‚¨ãƒ©ãƒ¼: ä¸æ˜ãªæ¤œè¨¼ã‚¿ã‚¤ãƒ—ã§ã™: $validation_type" >&2
            export VALIDATION_ERROR_CODE=1000
            return 1
            ;;
    esac

    return 0
}
```

### ç°¡æ˜“çš„ãªé–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆ

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½œæˆã™ã‚‹
# å¼•æ•°: $1=å…ƒãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹, $2=ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å…ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
# æˆ»ã‚Šå€¤: 0=æˆåŠŸ, 1=å¤±æ•—
create_backup() {
    local source_file="$1"
    local backup_dir="${2:-./backups}"

    # å®Ÿè£…...
}

# ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã™ã‚‹
# å¼•æ•°: $1=ãƒ¬ãƒ™ãƒ« (INFO|WARN|ERROR), $2=ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
log_message() {
    local level="$1"
    local message="$2"

    # å®Ÿè£…...
}
```

## ğŸ’¡ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ

### åŠ¹æœçš„ãªã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ

```bash
# âœ… è‰¯ã„ä¾‹: æ„å›³ã‚’èª¬æ˜ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆ
# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆçµ‚äº†æ™‚ã«è‡ªå‹•å‰Šé™¤ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®š
local temp_file=$(mktemp)
trap 'rm -f "$temp_file"' EXIT

# âœ… è‰¯ã„ä¾‹: è¤‡é›‘ãªå‡¦ç†ã®èƒŒæ™¯ã‚’èª¬æ˜
# ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’æœ€é©åŒ–ã™ã‚‹ãŸã‚ã€å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒãƒ£ãƒ³ã‚¯å˜ä½ã§å‡¦ç†
while IFS= read -r -n 4096 chunk; do
    process_chunk "$chunk"
done < "$large_file"

# âœ… è‰¯ã„ä¾‹: åˆ¶ç´„ã‚„å‰ææ¡ä»¶ã‚’æ˜è¨˜
# ã“ã®å‡¦ç†ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ2GBæœªæº€ã®å ´åˆã®ã¿å‹•ä½œï¼ˆãƒ¡ãƒ¢ãƒªåˆ¶ç´„ã®ãŸã‚ï¼‰
if [ $(stat -c%s "$file") -lt 2147483648 ]; then
    process_in_memory "$file"
else
    process_streaming "$file"
fi

# âœ… è‰¯ã„ä¾‹: è¨­å®šå€¤ã®æ„å‘³ã‚’èª¬æ˜
local timeout="${REQUEST_TIMEOUT:-30}"  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ30ç§’ã€ç’°å¢ƒå¤‰æ•°ã§ä¸Šæ›¸ãå¯èƒ½
local retry_count="${MAX_RETRIES:-3}"   # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3å›ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§å¤‰æ›´å¯èƒ½

# âœ… è‰¯ã„ä¾‹: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹æ³¨æ„
# ã“ã®æ­£è¦è¡¨ç¾ã¯å¤§è¦æ¨¡ãªãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã«æœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹
# ãƒãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚’é¿ã‘ã‚‹ãŸã‚ã€è²ªæ¬²ã§ãªã„ãƒãƒƒãƒãƒ³ã‚°ã‚’ä½¿ç”¨
if [[ "$input" =~ ^([^[:space:]]+)[[:space:]]+([^[:space:]]+)$ ]]; then
    local first="${BASH_REMATCH[1]}"
    local second="${BASH_REMATCH[2]}"
fi
```

### é¿ã‘ã‚‹ã¹ãã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ

```bash
# âŒ æ‚ªã„ä¾‹: æ˜ç™½ãªã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã™ã‚‹
# å¤‰æ•°xã«5ã‚’ä»£å…¥
x=5

# âŒ æ‚ªã„ä¾‹: ã‚³ãƒ¼ãƒ‰ã¨çŸ›ç›¾ã™ã‚‹å¤ã„ã‚³ãƒ¡ãƒ³ãƒˆ
# ã“ã®é–¢æ•°ã¯ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã™ã‚‹
send_notification() {
    # å®Ÿéš›ã«ã¯SMSã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰...
    send_sms "$message"
}

# âŒ æ‚ªã„ä¾‹: å€‹äººçš„ãªã‚³ãƒ¡ãƒ³ãƒˆ
# ã“ã®éƒ¨åˆ†ã¯ç§ãŒä½œã£ãŸã®ã§è§¦ã‚‰ãªã„ã§ãã ã•ã„
process_data() {
    # ...
}

# âŒ æ‚ªã„ä¾‹: ä¸è¦ãªè©³ç´°ã‚³ãƒ¡ãƒ³ãƒˆ
# forãƒ«ãƒ¼ãƒ—ã§é…åˆ—ã®å„è¦ç´ ã‚’å‡¦ç†
for item in "${array[@]}"; do
    echo "$item"  # å„è¦ç´ ã‚’å‡ºåŠ›
done

# âŒ æ‚ªã„ä¾‹: ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’æ®‹ã™
# å¤ã„ã‚³ãƒ¼ãƒ‰
# echo "ãƒ‡ãƒãƒƒã‚°: $variable"
# æ–°ã—ã„ã‚³ãƒ¼ãƒ‰
log_debug "Variable: $variable"
```

## ğŸ“‚ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆ

### ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®æ´»ç”¨

```bash
#!/bin/bash
# =====================================================================
# ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# =====================================================================

set -euo pipefail

# =====================================================================
# å®šæ•°ã¨è¨­å®šå€¤ã®å®šç¾©
# =====================================================================

readonly SCRIPT_VERSION="1.2.0"
readonly DATA_DIR="/data/input"
readonly OUTPUT_DIR="/data/output"
readonly TEMP_DIR="/tmp/processor"
readonly MAX_FILE_SIZE="104857600"  # 100MB
readonly DEFAULT_THREADS="4"

# ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã®è¨­å®šä¸Šæ›¸ã
readonly THREAD_COUNT="${PROCESSOR_THREADS:-$DEFAULT_THREADS}"
readonly LOG_LEVEL="${LOG_LEVEL:-INFO}"

# =====================================================================
# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ç¾¤
# =====================================================================

# ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
log_info() {
    local message="$1"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [INFO] $message"
}

log_error() {
    local message="$1"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] [ERROR] $message" >&2
}

# ãƒ•ã‚¡ã‚¤ãƒ«æ¤œè¨¼é–¢æ•°
validate_input_file() {
    local file_path="$1"

    # ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    if [ ! -f "$file_path" ]; then
        log_error "å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $file_path"
        return 1
    fi

    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
    local file_size=$(stat -c%s "$file_path")
    if [ "$file_size" -gt "$MAX_FILE_SIZE" ]; then
        log_error "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¾ã™: $file_size bytes (æœ€å¤§: $MAX_FILE_SIZE bytes)"
        return 1
    fi

    # ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã®ãƒã‚§ãƒƒã‚¯
    if ! file "$file_path" | grep -q "text"; then
        log_error "ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã‚ã‚Šã¾ã›ã‚“: $file_path"
        return 1
    fi

    return 0
}

# =====================================================================
# ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–¢æ•°ç¾¤
# =====================================================================

# ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†
preprocess_data() {
    local input_file="$1"
    local output_file="$2"

    log_info "ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†ã‚’é–‹å§‹: $input_file"

    # ç©ºè¡Œã¨ã‚³ãƒ¡ãƒ³ãƒˆè¡Œã‚’å‰Šé™¤
    grep -v '^$' "$input_file" | grep -v '^#' > "$output_file"

    # æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®æ­£è¦åŒ–ï¼ˆUTF-8ã«å¤‰æ›ï¼‰
    iconv -f utf-8 -t utf-8 -c "$output_file" > "${output_file}.tmp"
    mv "${output_file}.tmp" "$output_file"

    log_info "ãƒ‡ãƒ¼ã‚¿ã®å‰å‡¦ç†ãŒå®Œäº†: $output_file"
    return 0
}

# ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›å‡¦ç†
transform_data() {
    local input_file="$1"
    local output_file="$2"

    log_info "ãƒ‡ãƒ¼ã‚¿å¤‰æ›ã‚’é–‹å§‹: $input_file"

    # CSVå½¢å¼ã«å¤‰æ›
    awk -F'\t' '{
        # ã‚¿ãƒ–åŒºåˆ‡ã‚Šã‹ã‚‰CSVã¸ã®å¤‰æ›
        gsub(/"/, "\"\"", $0)  # å¼•ç”¨ç¬¦ã®ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        printf "\"%s\",\"%s\",\"%s\"\n", $1, $2, $3
    }' "$input_file" > "$output_file"

    log_info "ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãŒå®Œäº†: $output_file"
    return 0
}

# ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼ã¨ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
clean_data() {
    local input_file="$1"
    local output_file="$2"

    log_info "ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹: $input_file"

    # ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿è¡Œã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    awk -F',' '{
        # ç©ºã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
        if ($1 == "" || $2 == "" || $3 == "") next

        # æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼
        if ($2 !~ /^[0-9]+(\.[0-9]+)?$/) next

        # æœ‰åŠ¹ãªè¡Œã®ã¿å‡ºåŠ›
        print $0
    }' "$input_file" > "$output_file"

    log_info "ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ãŒå®Œäº†: $output_file"
    return 0
}

# =====================================================================
# ãƒ¡ã‚¤ãƒ³å‡¦ç†é–¢æ•°
# =====================================================================

# ãƒ¡ã‚¤ãƒ³é–¢æ•°
main() {
    local input_file="${1:-}"
    local output_file="${2:-}"

    # å¼•æ•°ã®æ¤œè¨¼
    if [ -z "$input_file" ] || [ -z "$output_file" ]; then
        log_error "ä½¿ç”¨æ–¹æ³•: $0 <å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«> <å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«>"
        return 1
    fi

    log_info "ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™"
    log_info "å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«: $input_file"
    log_info "å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«: $output_file"

    # å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
    if ! validate_input_file "$input_file"; then
        return 1
    fi

    # å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æº–å‚™
    mkdir -p "$(dirname "$output_file")"

    # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®æº–å‚™
    local temp_file1="$TEMP_DIR/preprocessed_$$.txt"
    local temp_file2="$TEMP_DIR/transformed_$$.txt"

    # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã®è¨­å®š
    trap 'rm -f "$temp_file1" "$temp_file2"' EXIT

    # å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®å®Ÿè¡Œ
    {
        preprocess_data "$input_file" "$temp_file1" && \
        transform_data "$temp_file1" "$temp_file2" && \
        clean_data "$temp_file2" "$output_file"
    } || {
        log_error "ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ"
        return 1
    }

    # å‡¦ç†çµæœã®çµ±è¨ˆ
    local input_lines=$(wc -l < "$input_file")
    local output_lines=$(wc -l < "$output_file")

    log_info "å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸ"
    log_info "å…¥åŠ›è¡Œæ•°: $input_lines"
    log_info "å‡ºåŠ›è¡Œæ•°: $output_lines"
    log_info "å‰Šé™¤ã•ã‚ŒãŸè¡Œæ•°: $((input_lines - output_lines))"

    return 0
}

# =====================================================================
# ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
# =====================================================================

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
main "$@"
```

## ğŸš§ TODOã¨FIXMEã‚³ãƒ¡ãƒ³ãƒˆ

### æ¨™æº–çš„ãªTODOã‚³ãƒ¡ãƒ³ãƒˆ

```bash
# =====================================================================
# TODOã‚³ãƒ¡ãƒ³ãƒˆã®æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
# =====================================================================

# TODO: 2024-02-01 - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®ãƒ—ãƒ¼ãƒªãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹
# ç¾åœ¨ã®å®Ÿè£…ã§ã¯æ¯å›æ–°ã—ã„æ¥ç¶šã‚’ä½œæˆã—ã¦ãŠã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæ‚ªã„
# æ¥ç¶šãƒ—ãƒ¼ãƒ«ã‚’å°å…¥ã—ã¦ã€å†åˆ©ç”¨ã‚’å¯èƒ½ã«ã™ã‚‹

# FIXME: 2024-01-20 - ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®ä¿®æ­£
# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒä¸å®Œå…¨ã§ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã‚ã‚Š
# trapã®è¨­å®šã‚’è¦‹ç›´ã—ã¦ã€ã™ã¹ã¦ã®ãƒªã‚½ãƒ¼ã‚¹ãŒç¢ºå®Ÿã«è§£æ”¾ã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

# HACK: 2024-01-15 - ä¸€æ™‚çš„ãªå›é¿ç­–
# å¤–éƒ¨APIã®ãƒ¬ãƒ¼ãƒˆåˆ¶é™å•é¡Œã‚’å›é¿ã™ã‚‹ãŸã‚ã€ä¸€æ™‚çš„ã«é…å»¶ã‚’è¿½åŠ ã—ã¦ã„ã‚‹
# æœ¬å½“ã¯APIå´ã®å•é¡Œã‚’ä¿®æ­£ã™ã¹ã

# NOTE: 2024-01-10 - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã™ã‚‹æ³¨æ„
# ã“ã®é–¢æ•°ã¯å¤§è¦æ¨¡ãªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ä¸‹ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
# å°†æ¥çš„ã«ã¯ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã«ç§»è¡Œã™ã‚‹äºˆå®š

# XXX: 2024-01-05 - å±é™ºãªæ“ä½œ
# rm -rfã‚’ç›´æ¥å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚ã€å‰Šé™¤å¯¾è±¡ã®ç¢ºèªãŒå¿…è¦
# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦å®‰å…¨ã«ã™ã‚‹

# BUG: 2024-01-01 - æ—¢çŸ¥ã®ãƒã‚°
# ç‰¹å®šã®æ¡ä»¶ä¸‹ã§ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
# å†ç¾æ¡ä»¶ã‚’èª¿æŸ»ä¸­

# =====================================================================
# å„ªå…ˆåº¦ä»˜ãTODOã®ä¾‹
# =====================================================================

# å„ªå…ˆåº¦: é«˜ - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ä¿®æ­£
# TODO: HIGH: 2024-02-01 - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ã‚’å¼·åŒ–ã™ã‚‹
# ç¾åœ¨ã®å®Ÿè£…ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ç›´æ¥SQLã‚¯ã‚¨ãƒªã«åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ãŸã‚è„†å¼±
# ãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹

# å„ªå…ˆåº¦: ä¸­ - æ©Ÿèƒ½æ”¹å–„
# TODO: MEDIUM: 2024-02-15 - ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è¿½åŠ 
# ç¾åœ¨ã¯ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒç„¡é™ã«æˆé•·ã™ã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹

# å„ªå…ˆåº¦: ä½ - ã‚³ãƒ¼ãƒ‰æ”¹å–„
# TODO: LOW: 2024-03-01 - ã‚³ãƒ¼ãƒ‰ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–
# ç¾åœ¨ã®å®Ÿè£…ã¯å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã£ã¦ã„ã‚‹ãŸã‚ã€æ©Ÿèƒ½ã”ã¨ã«åˆ†å‰²ã™ã‚‹
```

### ã‚³ãƒ¡ãƒ³ãƒˆã‚¿ã‚°ã®ç®¡ç†

```bash
# =====================================================================
# ã‚³ãƒ¡ãƒ³ãƒˆã‚¿ã‚°ã®æ¤œç´¢ã¨ç®¡ç†
# =====================================================================

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®TODOã‚’æ¤œç´¢ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰
find_project_todos() {
    local project_dir="$1"

    echo "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®TODOä¸€è¦§:"
    echo "===================="

    find "$project_dir" -name "*.sh" -type f | while read -r file; do
        # å„ç¨®TODOã‚¿ã‚°ã‚’æ¤œç´¢
        grep -n -E "TODO|FIXME|HACK|NOTE|XXX|BUG" "$file" | \
        while read -r line; do
            local line_number=$(echo "$line" | cut -d: -f1)
            local comment=$(echo "$line" | cut -d: -f2-)
            echo "ãƒ•ã‚¡ã‚¤ãƒ«: $file"
            echo "è¡Œç•ªå·: $line_number"
            echo "ã‚³ãƒ¡ãƒ³ãƒˆ: $comment"
            echo "---"
        done
    done
}

# ç‰¹å®šã®å„ªå…ˆåº¦ã®TODOã‚’æŠ½å‡º
filter_todos_by_priority() {
    local project_dir="$1"
    local priority="$2"

    find "$project_dir" -name "*.sh" -type f -exec grep -l "TODO.*$priority" {} \;
}

# æœŸé™åˆ‡ã‚Œã®TODOã‚’æ¤œå‡º
check_overdue_todos() {
    local project_dir="$1"
    local current_date=$(date '+%Y-%m-%d')

    find "$project_dir" -name "*.sh" -type f | while read -r file; do
        grep -n "TODO.*[0-9]{4}-[0-9]{2}-[0-9]{2}" "$file" | \
        while read -r line; do
            local todo_date=$(echo "$line" | grep -o '[0-9]{4}-[0-9]{2}-[0-9]{2}')
            if [[ "$todo_date" < "$current_date" ]]; then
                echo "æœŸé™åˆ‡ã‚Œã®TODOãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:"
                echo "ãƒ•ã‚¡ã‚¤ãƒ«: $file"
                echo "è¡Œ: $line"
                echo "---"
            fi
        done
    done
}
```

## ğŸš€ ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã‚’å‹•ã‹ã—ã¦ç¢ºèªã—ã¦ã¿ã‚ˆã†

ãã‚Œã§ã¯ã€å®Ÿéš›ã«åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã‚’å®Ÿè·µã—ã¦ã€ãã®é‡è¦æ€§ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

:::step

1. ã‚³ãƒ¡ãƒ³ãƒˆä»˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

ä»¥ä¸‹ã®å†…å®¹ã§`commented_script.sh`ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
#!/bin/bash
# =====================================================================
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆå: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãƒ„ãƒ¼ãƒ«
# ä½œæˆè€…: ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒãƒ¼ãƒ 
# ä½œæˆæ—¥: 2024-01-15
# æ¦‚è¦: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›£è¦–ã—ã€ç•°å¸¸ã‚’æ¤œå‡ºã™ã‚‹
#
# æ©Ÿèƒ½:
#   - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
#   - ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è‡ªå‹•æ¤œå‡º
#   - ã—ãã„å€¤ã‚’è¶…ãˆãŸå ´åˆã®ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥
#   - ç›£è¦–çµæœã®ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
#
# ä½¿ç”¨æ–¹æ³•:
#   ./log_monitor.sh <ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«> [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«]
#
# å¼•æ•°:
#   $1: ç›£è¦–å¯¾è±¡ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
#   $2: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: config.iniï¼‰
#
# çµ‚äº†ã‚³ãƒ¼ãƒ‰:
#   0: æ­£å¸¸çµ‚äº†
#   1: å¼•æ•°ã‚¨ãƒ©ãƒ¼
#   2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼
#   3: è¨­å®šã‚¨ãƒ©ãƒ¼
# =====================================================================

set -euo pipefail

# =====================================================================
# å®šæ•°ã¨è¨­å®šå€¤ã®å®šç¾©
# =====================================================================

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±
readonly SCRIPT_VERSION="1.0.0"

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šå€¤
readonly DEFAULT_CONFIG_FILE="config.ini"
readonly DEFAULT_ERROR_THRESHOLD=10          # 1æ™‚é–“ã‚ãŸã‚Šã®ã‚¨ãƒ©ãƒ¼æ•°ã®ã—ãã„å€¤
readonly DEFAULT_WARNING_THRESHOLD=5         # 1æ™‚é–“ã‚ãŸã‚Šã®è­¦å‘Šæ•°ã®ã—ãã„å€¤
readonly DEFAULT_CHECK_INTERVAL=60          # ç›£è¦–é–“éš”ï¼ˆç§’ï¼‰
readonly DEFAULT_LOG_RETENTION_DAYS=7        # ãƒ­ã‚°ä¿æŒæœŸé–“ï¼ˆæ—¥ï¼‰

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹è¨­å®š
readonly SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
readonly LOG_FILE="$SCRIPT_DIR/monitor.log"
readonly REPORT_FILE="$SCRIPT_DIR/monitor_report.txt"
readonly TEMP_DIR="$SCRIPT_DIR/temp"

# ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ï¼ˆæœ€å°é™ã«é™å®šï¼‰
declare -g MONITOR_PID=""
declare -g RUNNING=false

# =====================================================================
# ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ç¾¤
# =====================================================================

# ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
# å¼•æ•°: $1=ãƒ¬ãƒ™ãƒ« (INFO|WARN|ERROR), $2=ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# æˆ»ã‚Šå€¤: ãªã—
log_message() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')

    echo "[$timestamp] [$level] $message" | tee -a "$LOG_FILE"

    # ERRORãƒ¬ãƒ™ãƒ«ã®å ´åˆã¯æ¨™æº–ã‚¨ãƒ©ãƒ¼ã«ã‚‚å‡ºåŠ›
    if [ "$level" = "ERROR" ]; then
        echo "[$timestamp] [$level] $message" >&2
    fi
}

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
# å¼•æ•°: $1=è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
# æˆ»ã‚Šå€¤: 0=æˆåŠŸ, 1=å¤±æ•—
load_configuration() {
    local config_file="$1"

    log_message "INFO" "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­: $config_file"

    if [ ! -f "$config_file" ]; then
        log_message "ERROR" "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $config_file"
        return 1
    fi

    # è¨­å®šå€¤ã®èª­ã¿è¾¼ã¿ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ï¼‰
    # TODO: MEDIUM: 2024-02-01 - è¨­å®šå€¤ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹
    # ç¾åœ¨ã¯è¨­å®šå€¤ã®å‹ãƒã‚§ãƒƒã‚¯ãŒè¡Œã‚ã‚Œã¦ã„ãªã„ãŸã‚ã€ä¸æ­£ãªå€¤ãŒè¨­å®šã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
    ERROR_THRESHOLD=$(grep "^ERROR_THRESHOLD=" "$config_file" | cut -d'=' -f2 || echo "$DEFAULT_ERROR_THRESHOLD")
    WARNING_THRESHOLD=$(grep "^WARNING_THRESHOLD=" "$config_file" | cut -d'=' -f2 || echo "$DEFAULT_WARNING_THRESHOLD")
    CHECK_INTERVAL=$(grep "^CHECK_INTERVAL=" "$config_file" | cut -d'=' -f2 || echo "$DEFAULT_CHECK_INTERVAL")

    # è¨­å®šå€¤ã®æ¤œè¨¼
    if [[ ! "$ERROR_THRESHOLD" =~ ^[0-9]+$ ]] || [ "$ERROR_THRESHOLD" -le 0 ]; then
        log_message "WARN" "ä¸æ­£ãªERROR_THRESHOLDå€¤ã§ã™ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ã—ã¾ã™: $ERROR_THRESHOLD -> $DEFAULT_ERROR_THRESHOLD"
        ERROR_THRESHOLD="$DEFAULT_ERROR_THRESHOLD"
    fi

    log_message "INFO" "è¨­å®šã®èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ"
    log_message "INFO" "ã‚¨ãƒ©ãƒ¼ã—ãã„å€¤: $ERROR_THRESHOLD"
    log_message "INFO" "è­¦å‘Šã—ãã„å€¤: $WARNING_THRESHOLD"
    log_message "INFO" "ç›£è¦–é–“éš”: $CHECK_INTERVAL ç§’"

    return 0
}

# =====================================================================
# ãƒ‡ãƒ¼ã‚¿å‡¦ç†é–¢æ•°ç¾¤
# =====================================================================

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ãƒ©ãƒ¼è§£æ
# å¼•æ•°: $1=ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹, $2=è§£ææœŸé–“ï¼ˆåˆ†ï¼‰
# æˆ»ã‚Šå€¤: ã‚¨ãƒ©ãƒ¼æ•°ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›
analyze_log_errors() {
    local log_file="$1"
    local period_minutes="$2"
    local since_time=$(date -d "$period_minutes minutes ago" '+%Y-%m-%d %H:%M:%S')

    # æŒ‡å®šæœŸé–“å†…ã®ãƒ­ã‚°ã‚’æŠ½å‡º
    local temp_error_log="$TEMP_DIR/errors_$$.txt"

    # HACK: awkã®æ™‚é–“æ¯”è¼ƒã¯ã‚·ã‚¹ãƒ†ãƒ ã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ä¸€æ™‚çš„ãªå®Ÿè£…
    # å°†æ¥çš„ã«ã¯å°‚ç”¨ã®ãƒ­ã‚°è§£æãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä½¿ç”¨ã‚’æ¤œè¨
    awk -v since="$since_time" '
    BEGIN { count = 0 }
    {
        # ãƒ­ã‚°ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ½å‡ºï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: YYYY-MM-DD HH:MM:SSï¼‰
        if (match($0, /([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2})/, timestamp)) {
            log_time = timestamp[1]
            if (log_time >= since) {
                # ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ
                if (tolower($0) ~ /error|exception|failed|critical|fatal/) {
                    count++
                }
            }
        }
    }
    END { print count }
    ' "$log_file" > "$temp_error_log"

    local error_count=$(cat "$temp_error_log")
    rm -f "$temp_error_log"

    echo "$error_count"
}

# ã‚¢ãƒ©ãƒ¼ãƒˆé€šçŸ¥ã®é€ä¿¡
# å¼•æ•°: $1=ã‚¢ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ™ãƒ«, $2=ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
# æˆ»ã‚Šå€¤: 0=æˆåŠŸ, 1=å¤±æ•—
send_alert() {
    local alert_level="$1"
    local message="$2"
    local subject="[ãƒ­ã‚°ç›£è¦–] $alert_level ã‚¢ãƒ©ãƒ¼ãƒˆ"
    local body="ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰$alert_levelãƒ¬ãƒ™ãƒ«ã®ã‚¢ãƒ©ãƒ¼ãƒˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚

æ™‚åˆ»: $(date)
ãƒ¬ãƒ™ãƒ«: $alert_level
ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: $message

è©³ç´°ãªç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆã¯ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: $REPORT_FILE"

    # XXX: ç¾åœ¨ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½ãŒæœªå®Ÿè£…
    # TODO: HIGH: 2024-01-20 - ãƒ¡ãƒ¼ãƒ«é€šçŸ¥æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹
    # ç¾åœ¨ã¯ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ã ã‘ã ãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡ãŒå¿…è¦
    log_message "$alert_level" "ã‚¢ãƒ©ãƒ¼ãƒˆ: $message"

    # FIXME: ä¸€æ™‚çš„ãªå›é¿ç­–ã¨ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ãƒ©ãƒ¼ãƒˆã‚’è¨˜éŒ²
    # æœ¬å½“ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡APIã‚’å‘¼ã³å‡ºã™ã¹ã
    echo "[$(date)] ALERT: $alert_level - $message" >> "$SCRIPT_DIR/alerts.log"

    return 0
}

# ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
# å¼•æ•°: $1=ãƒ¬ãƒãƒ¼ãƒˆæœŸé–“ï¼ˆåˆ†ï¼‰
# æˆ»ã‚Šå€¤: 0=æˆåŠŸ, 1=å¤±æ•—
generate_report() {
    local period_minutes="$1"
    local report_time=$(date '+%Y-%m-%d %H:%M:%S')

    {
        echo "ãƒ­ã‚°ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆ"
        echo "ç”Ÿæˆæ™‚åˆ»: $report_time"
        echo "ç›£è¦–æœŸé–“: éå» $period_minutes åˆ†"
        echo "========================================"
        echo ""

        # åŸºæœ¬çµ±è¨ˆ
        echo "åŸºæœ¬çµ±è¨ˆ:"
        echo "  ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«: $MONITOR_FILE"
        echo "  ã‚¨ãƒ©ãƒ¼ã—ãã„å€¤: $ERROR_THRESHOLD"
        echo "  è­¦å‘Šã—ãã„å€¤: $WARNING_THRESHOLD"
        echo ""

        # ã‚¨ãƒ©ãƒ¼åˆ†æ
        local error_count=$(analyze_log_errors "$MONITOR_FILE" "$period_minutes")
        echo "ã‚¨ãƒ©ãƒ¼åˆ†æ:"
        echo "  æ¤œå‡ºã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼æ•°: $error_count"

        if [ "$error_count" -gt "$ERROR_THRESHOLD" ]; then
            echo "  çŠ¶æ…‹: âš ï¸  ã—ãã„å€¤ã‚’è¶…ãˆã¦ã„ã¾ã™"
        elif [ "$error_count" -gt "$WARNING_THRESHOLD" ]; then
            echo "  çŠ¶æ…‹: âš ï¸  è­¦å‘Šãƒ¬ãƒ™ãƒ«ã§ã™"
        else
            echo "  çŠ¶æ…‹: âœ… æ­£å¸¸ã§ã™"
        fi
        echo ""

        # æœ€è¿‘ã®ã‚¨ãƒ©ãƒ¼ï¼ˆæœ€æ–°5ä»¶ï¼‰
        echo "æœ€è¿‘ã®ã‚¨ãƒ©ãƒ¼:"
        local since_time=$(date -d "$period_minutes minutes ago" '+%Y-%m-%d %H:%M:%S')
        grep -E "$since_time.*[Ee]rror|[Ee]xception|[Ff]ailed|[Cc]ritical" "$MONITOR_FILE" | \
            head -5 | sed 's/^/  /'

    } > "$REPORT_FILE"

    log_message "INFO" "ç›£è¦–ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ: $REPORT_FILE"
    return 0
}

# =====================================================================
# ãƒ¡ã‚¤ãƒ³å‡¦ç†é–¢æ•°
# =====================================================================

# ç›£è¦–ã®å®Ÿè¡Œ
# å¼•æ•°: ãªã—
# æˆ»ã‚Šå€¤: 0=æˆåŠŸ, 1=å¤±æ•—
run_monitor() {
    local check_count=0

    log_message "INFO" "ãƒ­ã‚°ç›£è¦–ã‚’é–‹å§‹ã—ã¾ã™"

    # ã‚·ã‚°ãƒŠãƒ«ãƒãƒ³ãƒ‰ãƒ©ã®è¨­å®š
    trap 'handle_shutdown' TERM INT
    trap 'handle_reload' HUP

    # ãƒ¡ã‚¤ãƒ³ç›£è¦–ãƒ«ãƒ¼ãƒ—
    while $RUNNING; do
        ((check_count++))

        log_message "INFO" "ç›£è¦–ãƒã‚§ãƒƒã‚¯ #$check_count ã‚’å®Ÿè¡Œã—ã¾ã™"

        # ã‚¨ãƒ©ãƒ¼æ•°ã®åˆ†æ
        local error_count=$(analyze_log_errors "$MONITOR_FILE" 60)  # éå»60åˆ†

        log_message "INFO" "éå»60åˆ†é–“ã®ã‚¨ãƒ©ãƒ¼æ•°: $error_count"

        # ã—ãã„å€¤ãƒã‚§ãƒƒã‚¯ã¨ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡
        if [ "$error_count" -gt "$ERROR_THRESHOLD" ]; then
            send_alert "ERROR" "ã‚¨ãƒ©ãƒ¼æ•°ãŒã—ãã„å€¤ã‚’è¶…ãˆã¦ã„ã¾ã™: $error_count > $ERROR_THRESHOLD"
        elif [ "$error_count" -gt "$WARNING_THRESHOLD" ]; then
            send_alert "WARNING" "ã‚¨ãƒ©ãƒ¼æ•°ãŒè­¦å‘Šãƒ¬ãƒ™ãƒ«ã§ã™: $error_count > $WARNING_THRESHOLD"
        fi

        # å®šæœŸçš„ãªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆï¼ˆ10å›ã”ã¨ï¼‰
        if (( check_count % 10 == 0 )); then
            generate_report 60
        fi

        # æ¬¡ã®ãƒã‚§ãƒƒã‚¯ã¾ã§å¾…æ©Ÿ
        sleep "$CHECK_INTERVAL"
    done

    log_message "INFO" "ãƒ­ã‚°ç›£è¦–ã‚’çµ‚äº†ã—ã¾ã™"
    return 0
}

# ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³å‡¦ç†
# å¼•æ•°: ãªã—
# æˆ»ã‚Šå€¤: ãªã—
handle_shutdown() {
    log_message "INFO" "ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‚·ã‚°ãƒŠãƒ«ã‚’å—ä¿¡ã—ã¾ã—ãŸ"
    RUNNING=false
}

# è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†
# å¼•æ•°: ãªã—
# æˆ»ã‚Šå€¤: ãªã—
handle_reload() {
    log_message "INFO" "è¨­å®šãƒªãƒ­ãƒ¼ãƒ‰ã‚·ã‚°ãƒŠãƒ«ã‚’å—ä¿¡ã—ã¾ã—ãŸ"

    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†èª­ã¿è¾¼ã¿
    if load_configuration "$CONFIG_FILE"; then
        log_message "INFO" "è¨­å®šã®å†èª­ã¿è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸ"
    else
        log_message "ERROR" "è¨­å®šã®å†èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ"
    fi
}

# =====================================================================
# ãƒ¡ã‚¤ãƒ³é–¢æ•°
# =====================================================================

# ãƒ¡ã‚¤ãƒ³é–¢æ•°
main() {
    # å¼•æ•°ã®æ¤œè¨¼
    if [ $# -lt 1 ]; then
        echo "ä½¿ç”¨æ–¹æ³•: $0 <ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«> [è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«]"
        echo "ä¾‹: $0 /var/log/application.log config.ini"
        return 1
    fi

    # ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã®è¨­å®š
    readonly MONITOR_FILE="$1"
    readonly CONFIG_FILE="${2:-$DEFAULT_CONFIG_FILE}"

    log_message "INFO" "ãƒ­ã‚°ç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚’èµ·å‹•ã—ã¾ã™"
    log_message "INFO" "ç›£è¦–å¯¾è±¡: $MONITOR_FILE"
    log_message "INFO" "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: $CONFIG_FILE"

    # å¿…è¦ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
    mkdir -p "$TEMP_DIR"

    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
    if ! load_configuration "$CONFIG_FILE"; then
        return 1
    fi

    # ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¤œè¨¼
    if [ ! -f "$MONITOR_FILE" ]; then
        log_message "ERROR" "ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $MONITOR_FILE"
        return 1
    fi

    if [ ! -r "$MONITOR_FILE" ]; then
        log_message "ERROR" "ç›£è¦–å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å–ã‚Œã¾ã›ã‚“: $MONITOR_FILE"
        return 1
    fi

    # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œãƒ•ãƒ©ã‚°ã®è¨­å®š
    RUNNING=true

    # ç›£è¦–ã®é–‹å§‹
    run_monitor

    return 0
}

# =====================================================================
# ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
# =====================================================================

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œ
main "$@"
```

2. å®Ÿè¡Œæ¨©é™ã®ä»˜ä¸

```bash
chmod +x commented_script.sh
```

3. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
cat > config.ini << 'EOF'
# ãƒ­ã‚°ç›£è¦–ãƒ„ãƒ¼ãƒ«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

# ã—ãã„å€¤è¨­å®š
ERROR_THRESHOLD=15
WARNING_THRESHOLD=5
CHECK_INTERVAL=30

# é€šçŸ¥è¨­å®š
ALERT_EMAIL=admin@example.com
ALERT_LEVEL=ERROR

# ãƒ­ã‚°è¨­å®š
LOG_LEVEL=INFO
LOG_RETENTION_DAYS=7
EOF
```

4. ãƒ†ã‚¹ãƒˆãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
# ãƒ†ã‚¹ãƒˆç”¨ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
cat > test_app.log << 'EOF'
2024-01-15 10:00:00 [INFO] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã¾ã—ãŸ
2024-01-15 10:00:01 [INFO] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ
2024-01-15 10:00:02 [INFO] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã—ã¾ã—ãŸ
2024-01-15 10:01:00 [WARNING] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãŒé«˜ã„ã§ã™: 85%
2024-01-15 10:01:30 [ERROR] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ
2024-01-15 10:01:31 [ERROR] Connection timeout after 30 seconds
2024-01-15 10:01:32 [INFO] å†æ¥ç¶šã‚’è©¦ã¿ã¾ã™
2024-01-15 10:01:35 [INFO] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å†æ¥ç¶šã—ã¾ã—ãŸ
2024-01-15 10:02:00 [ERROR] Invalid input data format
2024-01-15 10:02:01 [ERROR] Permission denied: /var/lib/app/data.db
2024-01-15 10:02:02 [WARNING] ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ãŒå°‘ãªã„ã§ã™: 15%
2024-01-15 10:03:00 [INFO] å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™
2024-01-15 10:03:01 [ERROR] Out of memory: Cannot allocate 1024 bytes
2024-01-15 10:03:02 [ERROR] Critical error in module processing
2024-01-15 10:03:03 [INFO] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’çµ‚äº†ã—ã¾ã™
EOF
```

5. ã‚³ãƒ¡ãƒ³ãƒˆã®åŠ¹æœã®ç¢ºèª

```bash
# ã‚³ãƒ¡ãƒ³ãƒˆä»˜ãã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œï¼ˆãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼‰
./commented_script.sh test_app.log config.ini

# ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
echo "=== ç”Ÿæˆã•ã‚ŒãŸãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« ==="
cat monitor.log

echo ""
echo "=== ç”Ÿæˆã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆ ==="
cat monitor_report.txt

echo ""
echo "=== ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ©ãƒ¼ãƒˆãƒ­ã‚° ==="
cat alerts.log
```

6. ã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢ã¨åˆ†æ

```bash
# TODOã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢
echo "=== TODOã‚³ãƒ¡ãƒ³ãƒˆã®æ¤œç´¢ ==="
grep -n "TODO\|FIXME\|HACK\|NOTE\|XXX\|BUG" commented_script.sh

echo ""
echo "=== é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸€è¦§ ==="
grep -A5 -B1 "é–¢æ•°å\|æ¦‚è¦\|å¼•æ•°\|æˆ»ã‚Šå€¤" commented_script.sh

echo ""
echo "=== ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®ä¸€è¦§ ==="
grep -n "===\|# .*=" commented_script.sh | head -10
```

7. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# é–¢æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æŠ½å‡ºï¼ˆç°¡æ˜“ç‰ˆï¼‰
echo "=== é–¢æ•°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æŠ½å‡º ==="
awk '
/^# é–¢æ•°å:/ {
    func_name = $0
    getline; overview = $0
    getline; getline; args = $0
    getline; returns = $0

    print "é–¢æ•°:", func_name
    print "æ¦‚è¦:", overview
    print args
    print returns
    print "----------------------------------------"
}
' commented_script.sh
```

:::

## ğŸ“‹ ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆã®åŸå‰‡

```bash
# âœ… å®ˆã‚‹ã¹ãåŸå‰‡
- ã‚³ãƒ¼ãƒ‰ã®ã€Œãªãœã€ã‚’èª¬æ˜ã—ã€ã€Œä½•ã‚’ã€ã¯ã‚³ãƒ¼ãƒ‰è‡ªä½“ã«ä»»ã›ã‚‹
- ã‚³ãƒ¡ãƒ³ãƒˆã¯å¸¸ã«æœ€æ–°ã®çŠ¶æ…‹ã‚’ä¿ã¤
- è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®èƒŒæ™¯ã‚„åˆ¶ç´„ã‚’æ˜è¨˜ã™ã‚‹
- ä»–ã®é–‹ç™ºè€…ãŒç†è§£ã§ãã‚‹è¨€è‘‰ã§æ›¸ã
- ä¸€è²«ã—ãŸãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä½¿ç”¨ã™ã‚‹

# âŒ é¿ã‘ã‚‹ã¹ãã“ã¨
- æ˜ç™½ãªã‚³ãƒ¼ãƒ‰ã‚’èª¬æ˜ã™ã‚‹å†—é•·ãªã‚³ãƒ¡ãƒ³ãƒˆ
- ã‚³ãƒ¼ãƒ‰ã¨çŸ›ç›¾ã™ã‚‹å¤ã„ã‚³ãƒ¡ãƒ³ãƒˆ
- å€‹äººçš„ãªæ„è¦‹ã‚„æ„Ÿæƒ…ã®è¨˜è¿°
- ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã®æ”¾ç½®
```

### ãƒãƒ¼ãƒ ã§ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„

```bash
# =====================================================================
# ã‚³ãƒ¡ãƒ³ãƒˆè¦ç´„ã®ä¾‹
# =====================================================================

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã®å¿…é ˆé …ç›®
# - ã‚¹ã‚¯ãƒªãƒ—ãƒˆåã¨æ¦‚è¦
# - ä½œæˆè€…ã¨ä½œæˆæ—¥
# - ä½¿ç”¨æ–¹æ³•ã¨å¼•æ•°
# - çµ‚äº†ã‚³ãƒ¼ãƒ‰
# - ä¸»è¦ãªæ©Ÿèƒ½ä¸€è¦§

# é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã®å¿…é ˆé …ç›®
# - é–¢æ•°åã¨æ¦‚è¦
# - å¼•æ•°ï¼ˆå‹ã¨èª¬æ˜ï¼‰
# - æˆ»ã‚Šå€¤ï¼ˆå€¤ã¨æ„å‘³ï¼‰
# - é‡è¦ãªå‰¯ä½œç”¨
# - ä½¿ç”¨ä¾‹

# TODOã‚³ãƒ¡ãƒ³ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
# TODO: [å„ªå…ˆåº¦] [YYYY-MM-DD] - [èª¬æ˜]
# å„ªå…ˆåº¦: HIGH, MEDIUM, LOW
```

### è‡ªå‹•ã‚³ãƒ¡ãƒ³ãƒˆãƒã‚§ãƒƒã‚¯

```bash
# ã‚³ãƒ¡ãƒ³ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
check_comment_quality() {
    local file="$1"
    local issues=0

    echo "ã‚³ãƒ¡ãƒ³ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯: $file"

    # é–¢æ•°ã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
    local function_count=$(grep -c "^[a-zA-Z_][a-zA-Z0-9_]*()" "$file")
    local comment_count=$(grep -c "^# é–¢æ•°å:" "$file")

    if [ "$function_count" -gt "$comment_count" ]; then
        echo "âŒ é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ (é–¢æ•°: $function_count, ã‚³ãƒ¡ãƒ³ãƒˆ: $comment_count)"
        ((issues++))
    fi

    # å¤ã„TODOã®ãƒã‚§ãƒƒã‚¯
    local old_todos=$(grep -c "TODO.*[0-9]{4}-[0-9]{2}-[0-9]{2}" "$file" | \
                     awk '{split($0, date, /:/); gsub(/.*-/, "", date[2]); if (date[2] < "'$(date +%Y%m%d)'") print}')

    if [ "$old_todos" -gt 0 ]; then
        echo "âš ï¸  æœŸé™åˆ‡ã‚Œã®TODOãŒ $old_todos ä»¶ã‚ã‚Šã¾ã™"
        ((issues++))
    fi

    # æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã®çµ±ä¸€æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    local mixed_comments=$(grep -c "^[^#]*[A-Za-z].*æ—¥æœ¬èª\|^[^#]*[ã-ã‚“ã‚¡-ãƒ³].*[A-Za-z]" "$file" || true)

    if [ "$mixed_comments" -gt 0 ]; then
        echo "âš ï¸  æ—¥æœ¬èªã¨è‹±èªãŒæ··åœ¨ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆãŒ $mixed_comments ä»¶ã‚ã‚Šã¾ã™"
        ((issues++))
    fi

    if [ $issues -eq 0 ]; then
        echo "âœ… ã‚³ãƒ¡ãƒ³ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯ãƒ‘ã‚¹"
        return 0
    else
        echo "âŒ $issues ä»¶ã®ã‚³ãƒ¡ãƒ³ãƒˆå“è³ªå•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ"
        return 1
    fi
}
```

## ã¾ã¨ã‚

åŠ¹æœçš„ãªã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã¯ã€ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å“è³ªã¨ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã‚‹é‡è¦ãªè¦ç´ ã§ã™ã€‚é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã‚³ãƒ¼ãƒ‰ã®æ„å›³ã‚’æ˜ç¢ºã«ã—ã€ãƒãƒ¼ãƒ ã§ã®å”æ¥­ã‚’å††æ»‘ã«ã—ã€å°†æ¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

:::note è¦ç‚¹ã®ã¾ã¨ã‚

- **ç›®çš„ã®æ˜ç¢ºåŒ–**: ã‚³ãƒ¡ãƒ³ãƒˆã¯ã‚³ãƒ¼ãƒ‰ã®ã€Œãªãœã€ã‚’èª¬æ˜ã™ã‚‹
- **æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã€é–¢æ•°ã‚³ãƒ¡ãƒ³ãƒˆã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®çµ±ä¸€
- **å®Ÿè·µçš„ãªå†…å®¹**: åˆ¶ç´„ã€å‰ææ¡ä»¶ã€ä½¿ç”¨ä¾‹ã‚’å«ã‚ã‚‹
- **ä¿å®ˆæ€§**: ã‚³ãƒ¡ãƒ³ãƒˆã¨ã‚³ãƒ¼ãƒ‰ã‚’å¸¸ã«åŒæœŸã•ã›ã‚‹
- **TODOç®¡ç†**: å„ªå…ˆåº¦ã¨æœŸé™ä»˜ãã®TODOã‚³ãƒ¡ãƒ³ãƒˆ
- **ãƒãƒ¼ãƒ è¦ç´„**: ä¸€è²«ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã®é©ç”¨

:::

è‰¯ã„ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€äººã®æ™‚é–“ã‚’ç¯€ç´„ã—ã€èª¤è§£ã‚’é˜²ãã€é–‹ç™ºåŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚ç‰¹ã«è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚„é‡è¦ãªå‡¦ç†ã§ã¯ã€é©åˆ‡ãªã‚³ãƒ¡ãƒ³ãƒˆãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆåŠŸã«å¤§ããè²¢çŒ®ã—ã¾ã™ã€‚

## é–¢é€£ãƒªãƒ³ã‚¯

- [ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](./style-guide)
- [ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®é–¢æ•°](../../control-structures/functions)
- [set -e -u -x -o pipefailã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](../error-handling/set-e-u-x-o-pipefail)
- [å®‰å…¨ãªä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ](../security/secure-temp-files)

## ã•ã‚‰ã«æ·±ãå­¦ç¿’ã—ãŸã„æ–¹ã¸

ã‚³ãƒ¡ãƒ³ãƒˆè¨˜è¿°ã®ã‚¹ã‚­ãƒ«ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ãŸã„æ–¹ã¯ã€å½“ç¤¾ã®ç ”ä¿®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚å®Ÿè·µçš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ¼”ç¿’ã‚’é€šã˜ã¦ã€ãƒ—ãƒ­å“è³ªã®ã‚³ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆä½œæˆã‚¹ã‚­ãƒ«ã‚’ä½“ç³»çš„ã«ç¿’å¾—ã§ãã¾ã™ã€‚